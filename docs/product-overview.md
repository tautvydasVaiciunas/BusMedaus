# BusMedaus Platform Functional Overview

## Product vision and scope
BusMedaus is a NestJS-powered backend that brings together authentication, user management, hive collaboration, task workflows, messaging, notifications, media handling, and audit logging to support collaborative beekeeping operations and their companion web console.【F:README.md†L1-L4】 The service portfolio is designed to let teams operate shared apiaries while coordinating work, documenting hive telemetry, and keeping an auditable trail of activity.

## User roles and access model
Authenticated accounts carry role metadata that drives every protected module through JWT and role guards.【F:src/auth/guards/jwt-auth.guard.ts†L1-L27】【F:src/auth/guards/roles.guard.ts†L1-L30】 New accounts default to the `member` role unless explicit roles are supplied, while administrators and managers receive elevated privileges for coordination tasks.【F:src/users/users.service.ts†L13-L31】【F:src/hives/hives.service.ts†L221-L225】

- **Administrators** can see all hives and tasks, manage user records, and access the audit log for compliance oversight.【F:src/hives/hives.service.ts†L28-L44】【F:src/tasks/tasks.service.ts†L32-L37】【F:src/users/users.controller.ts†L39-L58】【F:src/audit/audit.controller.ts†L15-L32】
- **Managers** inherit additional rights to maintain shared resources such as hives, media, and tasks, matching the business rules enforced in the domain services.【F:src/hives/hives.service.ts†L221-L225】【F:src/media/media.service.ts†L157-L174】【F:src/tasks/tasks.service.ts†L212-L218】
- **Members** retain access to the hives they own or join, can collaborate on assigned tasks, contribute media, and participate in discussions, with restrictions enforced by each module’s access checks.【F:src/hives/hives.service.ts†L36-L48】【F:src/tasks/tasks.service.ts†L204-L226】【F:src/messaging/messaging.service.ts†L49-L117】

## Authentication and session lifecycle
Public endpoints allow users to register, log in, refresh tokens, and log out, with each call returning a consistent token bundle that includes user profile details.【F:src/auth/auth.controller.ts†L7-L30】 Credentials are validated against hashed passwords, and both access and refresh tokens embed role information so downstream guards can authorize requests.【F:src/auth/auth.service.ts†L61-L152】 Refresh tokens are stored hashed, revoked on use, and invalidated during logout to protect sessions against replay attacks.【F:src/auth/auth.service.ts†L92-L214】

## Account and team administration
Administrators operate the user registry through secure endpoints that expose “who am I” lookups for any authenticated user and full CRUD-style management for admins. The service enforces unique emails, hashes passwords, and allows role and status updates so teams can onboard and deactivate members safely.【F:src/users/users.controller.ts†L33-L58】【F:src/users/users.service.ts†L13-L77】

## Hive workspace management
Hive records capture both ownership and operational telemetry such as apiary names, locations, queen status, productivity indices, inspection timestamps, and environmental readings, giving teams a complete picture of each colony.【F:src/hives/hive.entity.ts†L23-L91】 Authenticated users can list the hives they own or belong to (administrators see every hive), retrieve detailed records, and manage hive lifecycles—including creation, updates, and removal—subject to role- and ownership-based checks.【F:src/hives/hives.controller.ts†L61-L118】【F:src/hives/hives.service.ts†L28-L227】 Owners and managers can add or remove members, while the system prevents the owner from being removed inadvertently.【F:src/hives/hives.service.ts†L169-L218】 Whenever membership or metadata changes, the platform sends in-app, email, or push notifications to the affected beekeepers so everyone stays informed about hive access and status changes.【F:src/hives/hives.service.ts†L85-L215】

## Task management and hive workflows
Tasks tie day-to-day work to specific hives, storing titles, descriptions, due dates, priorities, inspection links, templates, and audit-ready authorship fields.【F:src/tasks/task.entity.ts†L16-L60】 The API exposes endpoints for listing hive-specific tasks, fetching individual work items, creating new jobs, updating details, changing statuses, and deleting tasks, with output presenters that include localized status and priority labels for the front-end.【F:src/tasks/tasks.controller.ts†L11-L68】【F:src/tasks/task.presenter.ts†L1-L102】 Role-aware guards ensure only hive members, assigned users, or leaders can manage tasks, while administrators retain global visibility.【F:src/tasks/tasks.service.ts†L32-L226】 Automatic notifications alert assignees about new work, updates, and status changes so time-sensitive duties never slip through the cracks.【F:src/tasks/tasks.service.ts†L92-L189】 Task statuses progress through `PENDING`, `IN_PROGRESS`, `COMPLETED`, `BLOCKED`, and `CANCELLED`, enabling structured workflow tracking.【F:src/tasks/task-status.enum.ts†L1-L6】

## Messaging and collaboration
Every task supports threaded discussion through comments, letting hive crews coordinate in context. Users can browse a global activity feed limited to the latest conversations from accessible tasks, drill into task-specific comment histories, and post new replies as long as they belong to the hive or hold administrative privileges.【F:src/messaging/messaging.controller.ts†L67-L95】【F:src/messaging/messaging.service.ts†L28-L117】 Each new comment triggers notifications to hive owners, members, and assignees—excluding the author—to ensure stakeholders hear about fresh insights or blockers promptly.【F:src/messaging/messaging.service.ts†L83-L103】

## Media library and evidence capture
The media module lets teams catalogue photos, documents, and sensor snapshots tied to hives, tasks, harvests, inspections, or audit events. Stored metadata includes URLs, MIME types, optional descriptions, structured metadata blobs, capture timestamps, and uploader identities.【F:src/media/media-item.entity.ts†L13-L58】 Authenticated users can list hive libraries, review their personal uploads, browse everything they are permitted to see, and create, update, or delete items as allowed by ownership and role checks (uploader, hive owner, manager, or administrator).【F:src/media/media.controller.ts†L54-L103】【F:src/media/media.service.ts†L29-L174】 Uploading new media alerts the rest of the hive so visual evidence and telemetry reach the full crew without manual follow-up.【F:src/media/media.service.ts†L77-L88】

## Notifications and alerts
Notifications are first-class records with channel, status, metadata, and linkage to related tasks, inspections, harvests, or audit events.【F:src/notifications/notification.entity.ts†L12-L87】 The service writes notifications for downstream dispatch, then attempts delivery across in-app, email (via SendGrid), and push (via Firebase Cloud Messaging) transports when configured.【F:src/notifications/notifications.service.ts†L57-L381】 Users can fetch their inbox, mark entries as read, and manage device subscriptions; token registration reuses existing subscriptions when possible, and removal enforces ownership to prevent tampering.【F:src/notifications/notifications.controller.ts†L70-L113】【F:src/notifications/notifications.service.ts†L104-L167】 Push subscriptions persist platform, metadata, and last-used timestamps so mobile or web clients can resume real-time alerts seamlessly.【F:src/notifications/notification-subscription.entity.ts†L13-L39】

## Operational dashboard
The dashboard synthesizes hive, task, notification, media, and messaging data into a snapshot tailored to the requesting user. It reports key statistics (active hives, open tasks, weekly completions, and fresh media), surfaces high-priority tasks with human-friendly labels, and curates alerts from recent notifications or fallback comments when no alerts exist.【F:src/dashboard/dashboard.service.ts†L1-L165】 By pulling from the same access-controlled repositories used elsewhere, the dashboard automatically respects team boundaries while delivering actionable intelligence.

## Audit and compliance tooling
An audit middleware wraps every request, recording the HTTP method, path, status, duration, query parameters, and a redacted copy of the payload while filtering sensitive fields such as passwords and refresh tokens.【F:src/audit/audit.middleware.ts†L6-L55】 Entries are stored transactionally in an `audit_logs` table and can be reviewed by administrators through a dedicated endpoint that returns the most recent events with parsed detail payloads.【F:src/audit/audit.service.ts†L12-L32】【F:src/audit/audit.controller.ts†L15-L41】【F:src/audit/audit-log.entity.ts†L3-L18】 This makes it straightforward to trace configuration changes, membership updates, or suspicious activity across the platform.

## Health and service readiness
A lightweight unauthenticated health endpoint responds with `{ status: 'ok' }`, allowing operations teams and hosting providers to confirm that the API process is alive without requiring credentials.【F:src/health/health.controller.ts†L3-L8】

Together, these capabilities provide a comprehensive collaboration surface for beekeeping organizations, connecting day-to-day fieldwork with centralized oversight, communication, and auditability.
